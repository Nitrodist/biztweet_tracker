<!DOCTYPE html>
<html>
  <head>
    <title>Ruby on Rails: Welcome aboard</title>
    <style type="text/css" media="screen">

    </style>
    <script type="text/javascript">
      function about() {
        info = document.getElementById('about-content');
        if (window.XMLHttpRequest)
          { xhr = new XMLHttpRequest(); }
        else
          { xhr = new ActiveXObject("Microsoft.XMLHTTP"); }
        xhr.open("GET","rails/info/properties",false);
        xhr.send("");
        info.innerHTML = xhr.responseText;
        info.style.display = 'block'
      }
    </script>
    <link rel="stylesheet" type="text/css" media="all" href="/assets/application.css?body=1" />

    <script src="/assets/jquery.js?body=1" type="text/javascript"></script>
    <script src="/assets/twitterlib.js?body=1" type="text/javascript"></script>

    <script type="text/javascript">

      function getDayOfYear(d) {   // d is a Date object
        var yn = d.getFullYear();
        var mn = d.getMonth();
        var dn = d.getDate();
        var d1 = new Date(yn,0,1,12,0,0); // noon on Jan. 1
        var d2 = new Date(yn,mn,dn,12,0,0); // noon on input date
        var ddiff = Math.round((d2-d1)/864e5);
        return ddiff+1; 
      }

      function inRange(dayOfYear) {
        
        var yearDays = [
                       [ 360, 365 ],
                       [ 353, 358 ],
                       [ 346, 351 ],
                       [ 339, 344 ],
                       [ 332, 337 ],
                       [ 325, 330 ],
                       [ 318, 323 ],
                       [ 311, 316 ],
                       [ 304, 309 ],
                       [ 297, 302 ],
                       [ 290, 295 ],
                       [ 283, 288 ],
                       [ 276, 281 ],
                       [ 269, 274 ],
                       [ 262, 267 ],
                       [ 255, 260 ],
                       [ 248, 253 ],
                       [ 241, 246 ]
                       ]; 
        for (var i = 0; i < yearDays.length; i++) {
          if (yearDays[i][0] <= dayOfYear && dayOfYear <= yearDays[i][1])
            return i;
        }
        return -1;
      }

      var tweetWeeks = new Array(18);
      for (var i = 0; i < tweetWeeks.length; i++) {
        tweetWeeks[i] = new Array();
      }

      // Search for Nitrodist
      twitterlib.timeline('Nitrodist', { filter: '#CM2066' }, function (tweets, options) {
        $.each(tweets, function(i, tweet) {
          var day = getDayOfYear(new Date(Date.parse(tweet.created_at)));
          var position = inRange(day);
          if (position !== -1) {
            tweetWeeks[position].push(tweet);
          }
        });
        // with our other data structure
        $.each(tweetWeeks, function(i, tweetsForWeek) {
          $("#test").append("<h3>Week " + (18 - i) + "</h3><ul id=\"tweet_list_" + i + "\" class='tweet_list'></ul>");
          $.each(tweetsForWeek, function(j, ttweet) {
            $("#tweet_list_" + i).append(twitterlib.render(ttweet));
          });
        });
      });
    </script>
  
  </head>
  <body>
    <div id="page">
      <div id="sidebar">
        <ul id="sidebar-items">
          <li>
            <h3>About the Application</h3>
            <ul class="links">
              <li><a href="https://twitter.com/#!/search/%23CM2066">#CM2066 On Twitter</a></li>
              <li><a href="https://twitter.com/#!/MurrayMoman">@MurrayMoman</a></li>
              <li><a href="http://skullspace.ca">SkullSpace - A Hackerspace</a></li>
              <li><a href="http://rrc.mb.ca">Red River College</a></li>
            </ul>
          </li>
        </ul>
      </div>

      <div id="content">
        <h1>BizTweet Tracker</h1>
        <hr />

        <p id="test">

        </p>
        
        <ul id="list_of_tweets">
        </ul>
        
        
      </div>

      <div id="footer">&copy; Mark Campbell and Sean Mendoza 2011</div>
    </div>
  </body>
</html>
